<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NoÃ«l interactif avec Tata LÃ©lÃ©</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <button id="toggleMusic" class="sound-button">ðŸ”Š</button>
    </div>
    <script src="script.js"></script>
</body>
</html>

/* styles.css */
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: 'Press Start 2P', cursive;
    height: 100vh;
    width: 100vw;
    position: fixed;
}

#game-container {
    width: 100%;
    height: 100%;
    position: relative;
    touch-action: none;
}

#gameCanvas {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
    background-color: #000;
}

.sound-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.5);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    color: white;
    cursor: pointer;
    z-index: 1000;
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: manipulation;
}

@media (max-width: 768px) {
    .sound-button {
        bottom: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}

// Modifications du script.js
// Au dÃ©but du fichier, ajoutez :
let gameWidth = 800;
let gameHeight = 600;
const DESIGN_ASPECT_RATIO = gameWidth / gameHeight;

function initializeCanvas() {
    const container = document.getElementById('game-container');
    const containerWidth = container.clientWidth;
    const containerHeight = container.clientHeight;
    const containerAspectRatio = containerWidth / containerHeight;

    if (containerAspectRatio > DESIGN_ASPECT_RATIO) {
        gameHeight = containerHeight;
        gameWidth = gameHeight * DESIGN_ASPECT_RATIO;
    } else {
        gameWidth = containerWidth;
        gameHeight = gameWidth / DESIGN_ASPECT_RATIO;
    }

    canvas.width = gameWidth;
    canvas.height = gameHeight;
}

// Initialisation au chargement
window.addEventListener('load', () => {
    initializeCanvas();
    resizeCanvas();
});

// Gestion du redimensionnement
let resizeTimeout;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        initializeCanvas();
        resizeCanvas();
    }, 250);
});

// Gestion du son sur mobile
document.getElementById('toggleMusic').addEventListener('touchstart', (e) => {
    e.preventDefault();
    toggleMusic();
});

function toggleMusic() {
    if (audioElement.paused) {
        audioElement.play().catch(error => {
            console.error('Erreur lors de la lecture de la musique:', error);
        });
        document.getElementById('toggleMusic').textContent = 'ðŸ”Š';
    } else {
        audioElement.pause();
        document.getElementById('toggleMusic').textContent = 'ðŸ”ˆ';
    }
}

// Ajouter la gestion des Ã©vÃ©nements tactiles pour le jeu
let touchStartY;

canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    touchStartY = e.touches[0].clientY;
}, { passive: false });

canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const touchEndY = touch.clientY;
    
    if (isChoosing) {
        if (Math.abs(touchEndY - touchStartY) < 10) {
            // C'est un tap, gÃ©rer la sÃ©lection
            handleTouchChoice(touch);
        } else {
            // C'est un swipe
            if (touchEndY < touchStartY) {
                // Swipe vers le haut
                selectedChoice = (selectedChoice > 0) ? selectedChoice - 1 : choices.length - 1;
            } else {
                // Swipe vers le bas
                selectedChoice = (selectedChoice < choices.length - 1) ? selectedChoice + 1 : 0;
            }
            drawChoices();
        }
    } else {
        // Progression normale du dialogue
        handleTouch(e);
    }
}, { passive: false });

function handleTouchChoice(touch) {
    const rect = canvas.getBoundingClientRect();
    const y = touch.clientY - rect.top;
    const choiceBoxHeight = 60;
    const choiceBoxYStart = canvas.height - 160;
    
    for (let i = 0; i < choices.length; i++) {
        const choiceBoxY = choiceBoxYStart + (i * choiceBoxHeight);
        if (y >= choiceBoxY && y <= choiceBoxY + choiceBoxHeight) {
            selectedChoice = i;
            makeChoice();
            return;
        }
    }
}